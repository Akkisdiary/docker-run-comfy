#!/bin/bash

set -e

download_huggingface() {
    local download_url="$1"
    local target_file_path="$2"
    
    local target_dir=$(dirname "$target_file_path")
    local filename=$(basename "$target_file_path")
    
    echo "ü§ó Downloading HuggingFace model: $filename"
    echo "üìÅ Target file: $target_file_path"
    echo "üì• URL: $download_url"
    
    mkdir -p "$target_dir"

    if [ -z "$HF_TOKEN" ]; then
        echo "‚ùå HF_TOKEN is not set. Cannot download $destination_file."
        return 1
    fi
    
    aria2c -x 16 -s 16 -k 1M -d "$target_dir" -o "$filename" \
        --header="Authorization: Bearer $HF_TOKEN" \
        --max-tries=3 --retry-wait=5 \
        --auto-file-renaming=false --continue=true \
        --console-log-level=warn \
        "$download_url"
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ HuggingFace download completed for $download_url"
    else
        echo "‚ùå HuggingFace download failed for $download_url"
        return 1
    fi
}

download_huggingface "$@"
